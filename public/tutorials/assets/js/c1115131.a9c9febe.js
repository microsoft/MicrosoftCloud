"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[16],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),m=a,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||i;return n?r.createElement(h,o(o({ref:t},c),{},{components:n})):r.createElement(h,o({ref:t},c))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:a,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4816:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=n(7462),a=(n(7294),n(3905));const i={title:"6. Creating the Configuration Files",sidebar_position:1},o=void 0,s={unversionedId:"Authentication-App-With-NextJs-And-Microsoft-Graph/Creating-Configuration-Files",id:"Authentication-App-With-NextJs-And-Microsoft-Graph/Creating-Configuration-Files",title:"6. Creating the Configuration Files",description:"Now in the root of the project, let's create a file called process.d.ts. This file is responsible for adding the environment variables that we created previously. So, add the following code:",source:"@site/docs/Authentication-App-With-NextJs-And-Microsoft-Graph/06-Creating-Configuration-Files.md",sourceDirName:"Authentication-App-With-NextJs-And-Microsoft-Graph",slug:"/Authentication-App-With-NextJs-And-Microsoft-Graph/Creating-Configuration-Files",permalink:"/MicrosoftCloud/tutorials/docs/Authentication-App-With-NextJs-And-Microsoft-Graph/Creating-Configuration-Files",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"6. Creating the Configuration Files",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"5. Creating the pages for the application",permalink:"/MicrosoftCloud/tutorials/docs/Authentication-App-With-NextJs-And-Microsoft-Graph/Creating-Pages-For-The-Application"},next:{title:"7. Important changes in the Admin & Reminder Pages",permalink:"/MicrosoftCloud/tutorials/docs/Authentication-App-With-NextJs-And-Microsoft-Graph/Important-Changes-Admin-Reminder-Pages"}},l={},p=[],c={toc:p},u="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(u,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Now in the root of the project, let's create a file called ",(0,a.kt)("inlineCode",{parentName:"p"},"process.d.ts"),". This file is responsible for adding the environment variables that we created previously. So, add the following code:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"process.d.ts"))),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("b",null,"process.d.ts")),(0,a.kt)("br",null),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"declare namespace NodeJS {\n  export interface ProcessEnv {\n    NEXTAUTH_URL: string;\n    NEXTAUTH_SECRET: string;\n    AZURE_AD_CLIENT_SECRET: string;\n    AZURE_AD_CLIENT_ID: string;\n  }\n}\n"))),(0,a.kt)("br",null),(0,a.kt)("p",null,"When in the project we have some protected routes/pages, we need to create a file called: ",(0,a.kt)("inlineCode",{parentName:"p"},"middleware.ts"),". We just can access these protected routes/pages if we are authenticated. So, let's create this file and add the following code:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"middleware.ts"))),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("b",null,"middleware.ts")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"import { withAuth } from 'next-auth/middleware';\n\nexport default withAuth({\n  callbacks: {\n    authorized({ req, token }) {\n      if (req.nextUrl.pathname === '/admin') {\n        return token?.userRole === 'admin';\n      }\n\n      return !!token;\n    },\n  },\n});\n\nexport const config = { matcher: ['/reminder'] };\n"))),(0,a.kt)("br",null),(0,a.kt)("p",null,"Let's understand what is happening here. First, we are importing the ",(0,a.kt)("inlineCode",{parentName:"p"},"withAuth")," function from the ",(0,a.kt)("inlineCode",{parentName:"p"},"next-auth/middleware")," package. This function is responsible for protecting the routes/pages that we want. Then, we are exporting the ",(0,a.kt)("inlineCode",{parentName:"p"},"withAuth")," function with the ",(0,a.kt)("inlineCode",{parentName:"p"},"callbacks")," property. This property is responsible for checking if the user is authenticated or not. So, if the user is authenticated, we can access the protected pages. If the user is not an admin user, we can't access the ",(0,a.kt)("inlineCode",{parentName:"p"},"/admin")," page. And if the user is not authenticated, we can't access the ",(0,a.kt)("inlineCode",{parentName:"p"},"/reminder")," page. Just if it is logged in."),(0,a.kt)("p",null,"If you want to know more about the ",(0,a.kt)("inlineCode",{parentName:"p"},"middleware.ts")," file, ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"https://next-auth.js.org/configuration/nextjs#middleware"},"you can check the documentation of the next-auth")),"."),(0,a.kt)("p",null,"We need to make some important changes in the ",(0,a.kt)("inlineCode",{parentName:"p"},"admin.tsx")," file. So, let's add the following code:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"pages/admin.tsx"))),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("b",null,"pages/admin.tsx")),(0,a.kt)("br",null),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useState, useEffect } from 'react';\nimport { useSession } from 'next-auth/react';\nimport Layout from '../components/Layout/layout';\nimport AccessDenied from '../components/AccessDenied/access-denied';\n\nexport default function Page() {\n  const { data: session } = useSession();\n  const [content, setContent] = useState();\n\n  useEffect(() => {\n    const fetchData = async () => {\n      const res = await fetch('/api/examples/admin-protected');\n      const json = await res.json();\n      if (json.content) {\n        setContent(json.content);\n      }\n    };\n\n    fetchData();\n  }, [session]);\n\n  if (!session) {\n    return (\n      <Layout>\n        <AccessDenied />\n      </Layout>\n    );\n  }\n\n  return (\n    <Layout>\n      <h1>Admin Page</h1>\n      <p>\n        <strong>{content ?? '\\u00a0'}</strong>\n      </p>\n    </Layout>\n  );\n}\n"))),(0,a.kt)("br",null),(0,a.kt)("p",null,"Next step, inside the ",(0,a.kt)("inlineCode",{parentName:"p"},"api")," folder let's create a folder called ",(0,a.kt)("inlineCode",{parentName:"p"},"examples"),". And inside this folder, let's create a file called ",(0,a.kt)("inlineCode",{parentName:"p"},"admin-protected.ts"),". So, add the following code:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"api/examples/admin-protected.ts"))),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("b",null,"api/examples/admin-protected.ts")),(0,a.kt)("br",null),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'import { unstable_getServerSession } from "next-auth/next"\nimport { authOptions } from "../auth/[...nextauth]"\n\nimport type { NextApiRequest, NextApiResponse } from "next"\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  const session = await unstable_getServerSession(req, res, authOptions)\n\n  if (session) {\n    return res.send({\n      content:\n        "This is protected page. You can access this page because you are signed in.",\n    })\n  }\n\n  res.send({\n    error: "You must be signed in to view the protected page.",\n  })\n}\n'))),(0,a.kt)("br",null),(0,a.kt)("p",null,"And inside the ",(0,a.kt)("inlineCode",{parentName:"p"},"examples")," folder, let's create a file called ",(0,a.kt)("inlineCode",{parentName:"p"},"session.ts"),". So, add the following code:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"api/examples/session.ts"))),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("b",null,"api/examples/session.ts")),(0,a.kt)("br",null),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'import { unstable_getServerSession } from "next-auth";\nimport { authOptions } from "../auth/[...nextauth]";\n\nimport type { NextApiRequest, NextApiResponse } from "next";\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  const session = await unstable_getServerSession(req, res, authOptions);\n  res.send(JSON.stringify(session, null, 2));\n}\n'))),(0,a.kt)("br",null),(0,a.kt)("p",null,"Phew! We are almost done! However, there's some important changes that we need to do in the ",(0,a.kt)("inlineCode",{parentName:"p"},"Admin")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"Reminder")," pages. Let's see this in the next session!"))}d.isMDXComponent=!0}}]);